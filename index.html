<!DOCTYPE html>
<html>
<head>
  <!-- Majority of this code was from JSEncrypt. -->
  <!-- Additional features such as private key encryption, public key decryption, and displaying the results in hex were written by Michael Rose -->
  <title>Online RSA Key Generator</title>
  <!--<base id="basetag" href="/jsencrypt/">-->
  <!--[if IE]>
  <script type='text/javascript'>
    (function() {
      var tag = document.getElementById('basetag');
      tag.href = location.protocol + '//' + location.host + '/jsencrypt/';
    }());
  </script>
  <![endif]-->
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="	https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="jsencrypt.js"></script>
  <script type="text/javascript" src="primeList.js"></script>

  <link rel="stylesheet" type="text/css" href="style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="tab">
  <button class="tablinks" onclick="openTabs(event, 'generateKey')" id="defaultOpen">Key Creator</button>
  <button class="tablinks" onclick="openTabs(event, 'encryptdecrypt')">Encrypt/Decrypt</button>
</div>

<div class="container">
  <div class="tabcontent" id="generateKey">
  <div class="row">
  <div class="panel panel-default">
    <div class="panel-heading" id="titleBar"><h1>Online RSA Key Generator</h1></div>
    <div class="panel-body">
      <div class="col-lg-2" id="keyInputArea">
        <div class="input-group mb-3">
          <label class="input-group-text" for="key-size">Key Size</label>
          <select class="form-select" id="key-size">
            <option value="256">256</option>
            <option value="512">512</option>
            <option value="1024" selected>1024</option>
            <option value="2048">2048</option>
            <option value="4096">4096</option>
          </select>
        </div>

        <!-- Public Exponent -->
        <div class="input-group mb-3">
          <label class="input-group-text" for="public-exponent">Public exponent</label>
          <select class="form-select" id="public-exponent">
            <option value="65537">65537 (default)</option>
          </select>
        </div>

        <button id="generate" class="btn btn-primary">Generate Keys</button>
        <br>
        <span id="loading"><img src='loading.gif'></span>
        <br>&nbsp;<br>
        <span><i><small id="time-report"></small></i></span>
        <br>&nbsp;<br>
      </div>
      <!-- The values the program created -->
       <div class="d-flex align-items-center highlight-toolbar ps-3 pe-2 py-1 border-0 border-top border-bottom">
        <small class="font-monospace text-body-secondary">First Prime (p)</small>
        <div classs="d-flex ms-auto">
          <button type="button" class="btn-clipboard mt-0 me-0" aria-label="Copy to clipboard">ðŸ“‹</button>
        </div>
       </div>
       <div class="highlight">
        <pre tabindex="0" class="chroma">
          1234567890
        </pre>
       </div>
      <div id="reportDiv">
      <span id="report">
        First Prime (p):<br>
        <textarea type="text" id="p" class="pqmod" rows="2" cols="70" disabled></textarea>
        <br><br>
        Second Prime (q):<br>
        <textarea type="test" id="q" class="pqmod" rows="2" cols="70" disabled></textarea>
        <br><br>
        Modulus (p * q):<br>
        <textarea type="text" id="modulus" class="pqmod" rows="4" cols="70" disabled></textarea>
        <br><br>
      </span>
      </div>
      <div class="col-lg-10" id="keyArea">
        <div class="row">
          <div class="col-lg-6">
            <label for="privkey">Private Key</label><br/>
            <small>
              <textarea id="privkey" class="privpubKey" rows="15" cols="70" disabled></textarea>
            </small>
          </div>
          <div class="col-lg-6">
            <label for="pubkey">Public Key</label><br/>
            <small><textarea id="pubkey" class="privpubKey" rows="15" cols="70" readonly="readonly" disabled></textarea></small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
<!-- start encrypt decrypt section -->
<div class="tabcontent" id="encryptdecrypt">
<div class="row">
  <div class="panel panel-default">
    <div class="panel-heading" id="encryptionHeading"><h3>RSA Encryption Test</h3></div>
    <div class="panel-body">
      <div id="textInArea">
        <div class="col-lg-5">
          <label>Paste Key Here:</label><br/>
          <textarea id="privkeyInput" class="privpubInput" rows="15" cols="70"></textarea>
        </div>
        <div class="col-lg-5">
          <label for="input">Paste text here:</label><br/>
          <textarea id="input" name="input" class="privpubInput" cols="70" rows="4"></textarea>
        </div>
        <div class="col-lg-5">
          <label for="inputctext">Paste cipher text here:</label><br/>
          <textarea id="inputctext" name="inputctext" class="privpubInput" cols="70" rows="4"></textarea>
        </div>
        <div class="col-lg-2">
          <label>&nbsp;</label><br/>
          <button id="execute" class="btn btn-primary">Encrypt / Decrypt</button>
        </div>
      </div>
      <div id="cipherTextOutArea">
        
        <div class="col-lg-5">
          <label for="crypted">Result:</label><br/>
          <textarea id="crypted" class="results" name="crypted" cols="70" rows="4" disabled></textarea>
        </div>
        <div class="col-lg-5">
          <label for="hex">Result (hex):</label><br/>
          <textarea id="hex" class="results" name="hex" cols="70" rows="4" disabled></textarea>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
<script type="text/javascript">
  $(function () {
    //Change the key size value for new keys
    $(".change-key-size").each(function (index, value) {
      var el = $(value);
      var keySize = el.attr('data-value');
      console.log("hello");
      el.click(function (e) {
        var button = $('#key-size-obsolete');
        var globalKeySize = keySize;
        button.attr('data-value', keySize);
        button.html(keySize + ' bit <span class="caret"></span>');
        e.preventDefault();
      });
    });
    
    // Execute when they click the encrypt/decrypt button.
    //Changing this function
    $('#execute').click(function () {

      // Create the encryption object.
      var crypt = new JSEncrypt();
      // Set the private.
      crypt.setPrivateKey($('#privkeyInput').val());
      //return;
      // If no public key is set then set it here...
      var pubkey = $('#privkeyInput').val();
      if (!pubkey) {
        $('#privkeyInput').val(crypt.getPublicKey());
      }
      /*
      the variable p is used to check if the key given is a public one or a private one.  The public keys do not contain p or q values while the private keys do.  As such, this is used to determine if there is a p or q value.
      */
      var p = crypt.getP();

      // Get the input and crypted values.
      var input = $('#input').val();
      var crypted = $('#inputctext').val();
      //var crypted = $('#crypted').val();
      var hexCode = "";
      // Alternate the values.
      if (input) {
        if(!crypt.getP()) { //this is a public key
          $('#crypted').val(crypt.encrypt(input));
          $('#hex').val(crypt.convertToHex(crypt.encrypt(input)));
        }
        else {
          $('#crypted').val(crypt.encryptWithPrivate(input));
          $('#hex').val(crypt.convertToHex(crypt.encryptWithPrivate(input)));
        }
        //$('#input').val('');
      }
      else if (crypted) {
        var decrypted = "";
        if(!crypt.getP()) {
          decrypted = crypt.decryptWithPublic(crypted);
          hexDecrypted = crypt.convertToHex(decrypted);
        }
        else {
          decrypted = crypt.decrypt(crypted);
          hexDecrypted = crypt.convertToHex(decrypted);
        }

        $('#crypted').val(decrypted);
        $('#hex').val()
      }
    });

    var generatePrimeList = function () {
      var primeList = showMePrimes();
      for(i = 0; i < primeList.length; i++)
      {
        $('#public-exponent').append("<option>" + primeList[i] + "</option>");
      }

    };
    //Executed when generate new keys is clicked
    var generateKeys = function () {
      var sKeySize = $('#key-size').val();
      var keySize = parseInt(sKeySize);
      //set the p and q values given from the user
      //get the public exponent
      var e = parseInt($("#public-exponent").val()).toString(16);

      var crypt = new JSEncrypt({default_key_size: keySize, default_public_exponent: e});
      var async = $('#async-ck').is(':checked');
      var dt = new Date();
      var time = -(dt.getTime());
      if (async) {
        $('#time-report').text('.');
        var load = setInterval(function () {
          var text = $('#time-report').text();
          $('#time-report').text(text + '.');
        }, 500);
        crypt.getKey(function () {
          clearInterval(load);
          dt = new Date();
          time += (dt.getTime());
          $('#time-report').text('Generated in ' + time + ' ms');
          $('#privkey').val(crypt.getPrivateKey());
          $('#pubkey').val(crypt.getPublicKey());
        });
        return;
      }
      crypt.getKey();
      dt = new Date();
      time += (dt.getTime());
      $('#time-report').text('Generated in ' + time + ' ms');
      $('#privkey').val(crypt.getPrivateKey());
      $('#pubkey').val(crypt.getPublicKey());
      $('#p').val(crypt.getP());
      $('#q').val(crypt.getQ());
      $('#modulus').val(crypt.getN());
    };

    $('#loading').hide();
    
    $('#generate').click( function() {
      $('#loading').show();
      setTimeout(function() {
        var sKeySize = $('#key-size').val();
        var keySize = parseInt(sKeySize);
        //set the p and q values given from the user
        //get the public exponent
        var e = parseInt($("#public-exponent").val()).toString(16);

        var crypt = new JSEncrypt({default_key_size: keySize, default_public_exponent: e});
        var async = $('#async-ck').is(':checked');
        var dt = new Date();
        var time = -(dt.getTime());
        if (async) {
          $('#time-report').text('.');
          var load = setInterval(function () {
            var text = $('#time-report').text();
            $('#time-report').text(text + '.');
          }, 500);
          crypt.getKey(function () {
            clearInterval(load);
            dt = new Date();
            time += (dt.getTime());
            $('#time-report').text('Generated in ' + time + ' ms');
            $('#privkey').val(crypt.getPrivateKey());
            $('#pubkey').val(crypt.getPublicKey());
          });
          return;
        }
        crypt.getKey();
        dt = new Date();
        time += (dt.getTime());
        $('#time-report').text('Generated in ' + time + ' ms');
        $('#privkey').val(crypt.getPrivateKey());
        $('#pubkey').val(crypt.getPublicKey());
        $('#p').val(crypt.getP());
        $('#q').val(crypt.getQ());
        $('#modulus').val(crypt.getN());
        $('#loading').hide();
      }, 0);
    });
    generatePrimeList();
    document.getElementById("defaultOpen").click();
  });
</script>

</div>
</body>
</html>
